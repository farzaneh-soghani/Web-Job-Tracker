{% extends "base.html" %} {% block content %}
<div class="container">
  <h2 id="notes-title" style="margin-top: 80px; font-size: 25px">üìù Notizen</h2>

  <script type="application/json" id="bootstrap-jobs">
    {{ (jobs or [])|tojson }}
  </script>

  <form method="POST">
    <textarea
      name="notes"
      placeholder="Notizen, Telefonate, n√§chste Schritte..."
      style="
        width: 100%;
        height: 250px;
        padding: 20px;
        box-sizing: border-box;
        font-size: 16px;
        border-radius: 4px;
      "
    ></textarea>
    <div class="form-row">
      <button type="submit">Speichern</button>
      <a href="{{ url_for('index') }}"><button>‚Üê Zur√ºck</button></a>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    jtEnsureMigrated();
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const form = document.querySelector("form");
    const notesEl = document.querySelector('textarea[name="notes"]');
    const titleEl = document.getElementById("notes-title");

    if (!id) {
      window.location.replace(`{{ url_for('index') }}`);
      return;
    }

    const job = jtFindJobById(id);
    if (!job) {
      window.location.replace(`{{ url_for('index') }}`);
      return;
    }

    titleEl.textContent = `üìù Notizen: ${job.firma || ""} - ${job.position || ""}`;
    notesEl.value = job.notes || "";

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const updated = jtNormalizeJob({
        ...job,
        id,
        notes: notesEl.value,
      });
      jtUpsertJob(updated);
      window.location.replace(`{{ url_for('index') }}`);
    });
  });
</script>
{% endblock %}
